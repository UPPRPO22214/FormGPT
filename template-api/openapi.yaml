openapi: 3.0.3
info:
  title: FormGPT API
  version: "0.1.0"
  description: API –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –æ–ø—Ä–æ—Å–æ–≤ —Å GPT –ø–æ–º–æ—â–Ω–∏–∫–æ–º

servers:
  - url: http://survey-service:8080

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
        createdAt:
          type: string
          format: date-time

    CreateSurveyRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string
        questions:
          type: array
          items:
            $ref: "#/components/schemas/CreateQuestionRequest"

    SurveyResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        ownerId:
          type: string
          format: uuid
        questions:
          type: array
          items:
            $ref: "#/components/schemas/QuestionResponse"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateQuestionRequest:
      type: object
      required:
        - title
        - type
      properties:
        id:
          type: integer
          nullable: true
          description: |
            ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
            –ï—Å–ª–∏ null –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å.
        title:
          type: string
        type:
          type: string
          enum: [single-choice, multiple-choice, text, scale-1-10]
        options:
          type: array
          items:
            type: string

    QuestionResponse:
      type: object
      properties:
        id:
          type: integer
        surveyId:
          type: integer
        title:
          type: string
        type:
          type: string
          enum: [single-choice, multiple-choice, text, scale-1-10]
        options:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Answer:
      type: object
      properties:
        questionId:
          type: integer
        value:
          type: string

    SurveyWithAnswersResponse:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        ownerId:
          type: string
          format: uuid
        hasUserResponded:
          type: boolean
          description: –û—Ç–≤–µ—Ç–∏–ª –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å
        userRespondedAt:
          type: string
          format: date-time
          nullable: true
        questions:
          type: array
          items:
            $ref: "#/components/schemas/QuestionWithAnswerResponse"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    QuestionWithAnswerResponse:
      type: object
      properties:
        id:
          type: integer
        surveyId:
          type: integer
        title:
          type: string
        type:
          type: string
          enum: [single-choice, multiple-choice, text, scale-1-10]
        options:
          type: array
          items:
            type: string
        userAnswer:
          type: string
          description: –û—Ç–≤–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SurveyAnswer:
      type: object
      properties:
        answers:
          type: array
          items:
            $ref: "#/components/schemas/Answer"

    GPTAnalysis:
      type: object
      properties:
        text:
          type: string
        score:
          type: string
          enum: [good, average, bad]

security:
  - bearerAuth: []

paths:
  /health:
    get:
      summary: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /auth/register:
    post:
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string

  /auth/login:
    post:
      summary: –õ–æ–≥–∏–Ω
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string

  /users/me:
    get:
      summary: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      security:
        - bearerAuth: []
      responses:
        '200':
          description: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"

  /surveys:
    get:
      summary: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –æ–ø—Ä–æ—Å–æ–≤
      security:
        - bearerAuth: []
      responses:
        '200':
          description: –°–ø–∏—Å–æ–∫ –æ–ø—Ä–æ—Å–æ–≤
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SurveyResponse"

    post:
      summary: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–ø—Ä–æ—Å
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSurveyRequest"
      responses:
        '201':
          description: –û–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SurveyResponse"

  /surveys/{surveyId}:
    get:
      summary: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–ø—Ä–æ—Å
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: –û–ø—Ä–æ—Å
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SurveyWithAnswersResponse"

    put:
      summary: –û–±–Ω–æ–≤–∏—Ç—å –æ–ø—Ä–æ—Å
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSurveyRequest"
      responses:
        '200':
          description: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –æ–ø—Ä–æ—Å
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SurveyResponse"

    delete:
      summary: –£–¥–∞–ª–∏—Ç—å –æ–ø—Ä–æ—Å
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: –£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω

  /surveys/{surveyId}/answers:
    post:
      summary: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ–ø—Ä–æ—Å
      description: |
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ–ø—Ä–æ—Å. 
        –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –æ—Ç–≤–µ—á–∞–ª –Ω–∞ —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å - –µ–≥–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—Ç–≤–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
        
        üîç **–ü—Ä–æ–≤–µ—Ä–∫–∏:**
        - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
        - –î–ª—è single-choice –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        - –î–ª—è scale-1-10 –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 10
        - –î–ª—è text –æ—Ç–≤–µ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 1000 —Å–∏–º–≤–æ–ª–æ–≤
        
        ‚úÖ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
        - –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å—Ç–∞—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–æ–≤—ã–º–∏
        - –≤–æ–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å (value = null)
        - –î–ª—è multiple-choice –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ `;`
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SurveyAnswer"
      responses:
        '200':
          description: –û—Ç–≤–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "success"

  /gpt/surveys/create:
    post:
      summary: –°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –æ–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ GPT
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                description:
                  type: string
                targetAudience:
                  type: string
                questionCount:
                  type: integer
      responses:
        '200':
          description: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–ø—Ä–æ—Å
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SurveyResponse"

  /gpt/surveys/{surveyId}/edit:
    put:
      summary: –£–ª—É—á—à–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ GPT
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                prompt:
                  type: string
                  description: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
                  nullable: true
                  example: "–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å—ã –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –¥–ª—è –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤"
      responses:
        '200':
          description: –£–ª—É—á—à–µ–Ω–Ω—ã–π –æ–ø—Ä–æ—Å
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SurveyResponse"

  /gpt/questions/{questionId}/edit:
    put:
      summary: –£–ª—É—á—à–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ GPT
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: questionId
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                prompt:
                  type: string
                  description: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
                  nullable: true
                  example: "–°–¥–µ–ª–∞–π –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –±–æ–ª–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏"
      responses:
        '200':
          description: –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuestionResponse"

  /gpt/surveys/{surveyId}/analyze:
    post:
      summary: –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ GPT
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –æ—Ü–µ–Ω–∫–∞ –æ–ø—Ä–æ—Å–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GPTAnalysis"

  /surveys/{surveyId}/stats:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ–ø—Ä–æ—Å—É
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: surveyId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ä–æ—Å–∞
          content:
            application/json:
              schema:
                type: object
                properties:
                  respondents:
                    type: integer
                  answersDistribution:
                    type: object
